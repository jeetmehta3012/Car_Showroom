!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=9)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));const r=e=>{0}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var r={RecordingStates:{NONE:0,ALL:1,NO_DOM:2,NO_ERROR:3}}},function(e,t,s){let r={MODE:"development",API_URL:"http://localhost:3010/",WEBSOCKET_URL:"ws://localhost:3010/",CDN_URL:"http://localhost:3010/",JS_PATH:"js/"};r={MODE:"production",API_URL:"https://api.browsee.io/",WEBSOCKET_URL:"wss://session.browsee.io/",CDN_URL:"https://cdn.browsee.io/",JS_PATH:"js/"},e.exports=r},function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return n}));const r=e=>{var t=e.url,s=e.method||"POST",r=e.dataType||"application/json",n=e.withCredentials||!0,i=e.success,o=e.data||null,a=e.headers,c=new XMLHttpRequest;for(var l in c.open(s,t,!0),c.setRequestHeader("content-type",r),a)c.setRequestHeader(l,a[l]);c.withCredentials=n,c.onreadystatechange=function(){i&&4==this.readyState&&200==this.status&&i(this.responseText)},o?c.send(o):c.send()},n=function(e,t,s){var r=document.createElement("script");if(r.src=e,r.onload=s,r.onreadystatechange=s,t)t.appendChild(r);else{var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(r,n)}}},,,,,,function(e,t,s){"use strict";s.r(t);var r=s(1),n=s(0),i={EventTypes:{NETWORK_CALL:1,EVENT:2,URL:3,IDENTIFY:4,MOUSE:5,PAGE_LOAD:6,COMPONENTS:7,CUSTOM_EVENT:8},ComponentAnalyticsTypes:{VIEW:1,TIME:2,CLICK:3},Integrations:{GOOGLE_ANALYTICS:1,INTERCOM:2,SLACK:3,TAWKTO:4},BrowseeUrlParams:{RECORD:"brRecord",TEST_INSTALLATION:"brTestInstall"},s4:()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1),generate12DigitString:()=>Math.random().toString().slice(2,14),generate12CharacterString:()=>i.s4()+i.s4()+i.s4(),guid:()=>i.s4()+i.s4()+"-"+i.s4()+"-"+i.s4()+"-"+i.s4()+"-"+i.s4()+i.s4()+i.s4(),objectEquals:(e,t)=>{if(null==e||null==t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;var s=Object.keys(e);return Object.keys(t).every((function(e){return-1!==s.indexOf(e)}))&&s.every((function(s){return i.objectEquals(e[s],t[s])}))},getPercentScroll:e=>{var t=document.body.scrollHeight,s=window.scrollY;void 0!==e&&(s=e);var r=window.innerHeight+s;return Math.round(100*r/t)},isDnt:()=>!!(window.doNotTrack||navigator.doNotTrack||navigator.msDoNotTrack)&&!!("1"==window.doNotTrack||"yes"==navigator.doNotTrack||"1"==navigator.doNotTrack||"1"==navigator.msDoNotTrack||"msTrackingProtectionEnabled"in window.external&&window.external.msTrackingProtectionEnabled()),testInstallation:e=>{const t=e=>`color: ${e}; font-weight: bold;`;console.log("%c Browsee integrated successfully!",t("green")),i.isDnt()&&console.log("%c Do Not Track detected!",t("red")),e&&(console.log("%c Current Session",t("green")),console.log(e))},isASCII:e=>/^[\x00-\x7F]*$/.test(e)};class o{constructor(){this.options={selectors:["id","class","tag","nthchild"],prefix_tag:!1,attribute_blacklist:[],attribute_whitelist:[],quote_attribute_when_needed:!1,id_blacklist:[],class_blacklist:[]}}isElement(e){return!(1!==(null!=e?e.nodeType:void 0))}getParents(e){var t,s;if(s=[],this.isElement(e))for(t=e;this.isElement(t);)s.push(t),t=t.parentNode;return s}getTagSelector(e){return this.sanitizeItem(e.tagName.toLowerCase())}sanitizeItem(e){return e.split("").map((function(e){return":"===e?"\\"+":".charCodeAt(0).toString(16).toUpperCase()+" ":/[ !"#$%&'()*+,.\/;<=>?@\[\\\]^`{|}~]/.test(e)?"\\"+e:escape(e).replace(/\%/g,"\\")})).join("")}sanitizeAttribute(e){return this.options.quote_attribute_when_needed?this.quoteAttribute(e):e.split("").map((function(e){return":"===e?"\\"+":".charCodeAt(0).toString(16).toUpperCase()+" ":/[ !"#$%&'()*+,.\/;<=>?@\[\\\]^`{|}~]/.test(e)?"\\"+e:escape(e).replace(/\%/g,"\\")})).join("")}quoteAttribute(e){var t,s;return s=!1,t=e.split("").map((function(e){return":"===e?(s=!0,e):"'"===e?(s=!0,"\\"+e):(s=s||escape(e===!e),e)})),s?"'"+t.join("")+"'":t.join("")}getIdSelector(e){var t,s,r,n;return r=this.options.prefix_tag?this.getTagSelector(e):"",t=e.getAttribute("id"),s=this.options.id_blacklist.concat(["",/\s/,/^\d/]),t&&null!=t&&""!==t&&this.notInList(t,s)&&(n=r+"#"+this.sanitizeItem(t),1===e.ownerDocument.querySelectorAll(n).length)?n:null}notInList(e,t){return!t.find((function(t){return"string"==typeof t?t===e:t.exec(e)}))}getClassSelectors(e){var t,s,r,n,i,o;if(o=[],null!=(t=e.getAttribute("class"))&&""!==(t=(t=t.replace(/\s+/g," ")).replace(/^\s|\s$/g,"")))for(r=0,n=(i=t.split(/\s+/)).length;r<n;r++)s=i[r],this.notInList(s,this.options.class_blacklist)&&o.push("."+this.sanitizeItem(s));return o}getAttributeSelectors(e){var t,s,r,n,i,o,a,c,l,d,h,u;for(h=[],n=0,o=(u=this.options.attribute_whitelist).length;n<o;n++)s=u[n],e.hasAttribute(s)&&h.push("["+s+"="+this.sanitizeAttribute(e.getAttribute(s))+"]");for(r=this.options.attribute_blacklist.concat(["id","class"]),i=0,a=(c=e.attributes).length;i<a;i++)l=(t=c[i]).nodeName,indexOf.call(r,l)>=0||(d=t.nodeName,indexOf.call(u,d)>=0)||h.push("["+t.nodeName+"="+this.sanitizeAttribute(t.nodeValue)+"]");return h}getNthChildSelector(e){var t,s,r,n,i,o,a;if(n=e.parentNode,i=this.options.prefix_tag?this.getTagSelector(e):"",null!=n)for(t=0,s=0,r=(a=n.childNodes).length;s<r;s++)if(o=a[s],this.isElement(o)&&(t++,o===e))return i+":nth-child("+t+")";return null}testSelector(e,t){var s,r;return s=!1,null!=t&&""!==t&&1===(r=e.ownerDocument.querySelectorAll(t)).length&&r[0]===e&&(s=!0),s}testUniqueness(e,t){var s;return 1===(s=e.parentNode.querySelectorAll(t)).length&&s[0]===e}testCombinations(e,t,s){var r,n,i,o,a,c,l,d,h,u,g,p,m;if(null==s&&(s=this.getTagSelector(e)),!this.options.prefix_tag){for(n=0,o=(u=this.getCombinations(t)).length;n<o;n++)if(r=u[n],this.testSelector(e,r))return r;for(i=0,a=(g=this.getCombinations(t)).length;i<a;i++)if(r=g[i],this.testUniqueness(e,r))return r}for(d=0,c=(p=this.getCombinations(t).map((function(e){return s+e}))).length;d<c;d++)if(r=p[d],this.testSelector(e,r))return r;for(h=0,l=(m=this.getCombinations(t).map((function(e){return s+e}))).length;h<l;h++)if(r=m[h],this.testUniqueness(e,r))return r;return null}getUniqueSelector(e){var t,s,r,n,i,o;for(o=this.getTagSelector(e),t=0,s=(r=this.options.selectors).length;t<s;t++){switch(r[t]){case"id":n=this.getIdSelector(e);break;case"tag":o&&this.testUniqueness(e,o)&&(n=o);break;case"class":null!=(i=this.getClassSelectors(e))&&0!==i.length&&(n=this.testCombinations(e,i,o));break;case"attribute":null!=(i=this.getAttributeSelectors(e))&&0!==i.length&&(n=this.testCombinations(e,i,o));break;case"nthchild":n=this.getNthChildSelector(e)}if(n)return n}return"*"}getSelector(e){var t,s,r,n,i,o,a;for(a=[],s=0,r=(n=this.getParents(e)).length;s<r;s++)if(t=n[s],null!=(o=this.getUniqueSelector(t))&&(a.unshift(o),i=a.join(" > "),this.testSelector(e,i)))return i;return null}getCombinations(e){var t,s,r,n,i,o,a;for(null==e&&(e=[]),a=[[]],t=r=0,i=e.length-1;0<=i?r<=i:r>=i;t=0<=i?++r:--r)for(s=n=0,o=a.length-1;0<=o?n<=o:n>=o;s=0<=o?++n:--n)a.push(a[s].concat(e[t]));return a.shift(),a=(a=a.sort((function(e,t){return e.length-t.length}))).map((function(e){return e.join("")}))}targetProperties(e){var t={nodeName:e.nodeName.toLowerCase()};if(e.id&&(t.domId=e.id),e.name&&(t.name=e.name),e.textContent){var s=e.textContent.replace(/^\s+/,"").replace(/\s+$/,"");s.length>200&&(s=s.substring(0,200)+"..."),t.text=s}try{t.cssSelector=this.getSelector(e)}catch(e){t.cssSelector=""}const r=["alt","src","value","type","action","onclick","href","target"],n=["password","email","phone"];if(e.attributes){for(var i=e.attributes,o=0;o<i.length;o++){var a=i[o];-1!==r.indexOf(a.name)&&(t.attributes||(t.attributes={}),t.attributes[a.name]=a.value)}t.attributes&&-1!=n.indexOf(t.attributes.type)&&delete t.attributes.value}return t}}const a=["input","textarea","select","option"],c=["input","textarea","select","option","pre","code","canvas"],l=["button","a"],d={attributes:!0,childList:!0,subtree:!0},h=1,u=2,g=3,p=4,m=(e,t)=>{const s=e.x-t.x,r=e.y-t.y;return s*s+r*r};class v{constructor(e,t){this.clickSequence=[],this.clickChanges={},this.selectorGenerator=new o,this.lastNetworkCallTime=(new Date).getTime(),this.lastMutationTime=(new Date).getTime(),this.rageClickCallback=e,this.deadClickCallback=t}triggerRageClick(e,t){Object(n.a)("This is a rage click: "+e.event.pageX+":"+e.event.pageY);var s=this.selectorGenerator.targetProperties(e.event.target);this.rageClickCallback({x:e.x,y:e.y,scrollX:e.scrollX,scrollY:e.scrollY},s,t,e.time)}triggerDeadClick(e,t){Object(n.a)("That was a dead click: "+e.event.pageX+":"+e.event.pageY),this.deadClickCallback({x:e.x,y:e.y,scrollX:e.scrollX,scrollY:e.scrollY},null,t,e.time)}setObserver(){var e=window.document.getElementsByTagName("body")[0];if(!this.observer){var t=this;this.observer=new MutationObserver((function(e){t.updateMutation(e)})),this.observer.observe(e,d)}}disconnectObserver(){this.observer&&(this.observer.disconnect(),this.observer=null)}updateClick(e,t,s){var r=document.location.pathname+document.location.hash,i=Math.floor(99999999*Math.random()+1);const o=e.event.target.tagName.toLowerCase();if(!this.shouldIgnoreForRageClick(o)){this.clickSequence.push({x:e.x,y:e.y}),this.checkSequenceProximity()&&(Object(n.a)("Rage Click"),this.triggerRageClick(e,r),this.resetClickTimers()),this.rageClickTimer&&window.clearTimeout(this.rageClickTimer);var a=this;this.rageClickTimer=window.setTimeout((function(){a.resetClickTimers()}),1500)}if(this.isActionableTarget(o))s(p);else{var c=u;this.isCTATarget(o)&&(Object(n.a)("CTA click"),c=g),this.currentClick=i,this.setObserver();var l=(new Date).getTime();a=this;window.setTimeout((function(){var t=document.location.pathname+document.location.hash;if(r==t&&a&&l>a.lastNetworkCallTime&&l>a.lastMutationTime&&c!=g)a.triggerDeadClick(e,r),s(u,{});else{var n=a.clickChanges[i];n||(n={}),r!==t&&(n.url=t),s(g,n),delete a.clickChanges[i]}a.currentClick==i&&(a.currentClick=null),a.disconnectObserver()}),1e3)}}updateNetworkCall(e){this.currentClick&&(this.clickChanges[this.currentClick]||(this.clickChanges[this.currentClick]={}),this.clickChanges[this.currentClick].calls||(this.clickChanges[this.currentClick].calls=[]),this.clickChanges[this.currentClick].calls.push(e)),this.lastNetworkCallTime=(new Date).getTime()}updateMutation(e){var t=0;e.forEach((function(e){e.addedNodes&&1==e.addedNodes.length&&"html2canvas-container"==e.addedNodes[0].className||e.removedNodes&&1==e.removedNodes.length&&"html2canvas-container"==e.removedNodes[0].className||t++})),t>0&&(this.currentClick&&(this.clickChanges[this.currentClick]||(this.clickChanges[this.currentClick]={}),this.clickChanges[this.currentClick].mutations=!0),this.lastMutationTime=(new Date).getTime())}resetClickTimers(){this.clickSequence=[]}isActionableTarget(e){return-1!=a.indexOf(e)}isCTATarget(e){return-1!=l.indexOf(e)}shouldIgnoreForRageClick(e){return-1!=c.indexOf(e)}checkSequenceProximity(){if(this.clickSequence.length<4)return!1;for(var e=JSON.parse(JSON.stringify(this.clickSequence)),t=0;t<e.length;t++){const s=0==t?e.length-1:t-1;if(m(e[s],e[t])>1e4)return!1}return!0}}const w=["text","password","file","datetime","datetime-local","date","month","time","week","number","range","email","url","search","tel","color"];class f{constructor(e,t){this.eventHandlers={},this.preventClick=!1,this.preventClickTwice=!1,this.typeLock=0,this.enterTarget=null,this.prevTimeOut=null,this.readyTimeOut=null,this.pageLoaded=!0,this.recordEvent=e,this.selectorGenerator=new o,this.checkUrl=t,this.addEventHandler("type","change",this.typeEventHandler),this.addEventHandler("clickAt","click",this.clickAtEventHandler,!0),this.addEventHandler("doubleClickAt","dblclick",this.doubleClickAtEventHandler,!0),this.addEventHandler("runScript","scroll",this.scrollEventHandler,!0),this.addEventHandler("checkPageLoaded","readystatechange",this.pageLoadEventHandler,!0),this.addEventHandler("select","focus",this.selectFocusEventHandler,!0),this.addEventHandler("blur","blur",this.blurFocusEventHandler,!0),this.addEventHandler("select","change",this.selectChangeEventHandler),this.addEventHandler("move","mousemove",this.mouseMovementHandler,!0),this.addEventHandler("blur","blur",this.windowBlurEventHandler,!0,!0),this.addEventHandler("focus","focus",this.windowFocusEventHandler,!0,!0),this.addEventHandler("resize","resize",this.windowResizeEventHandler,!0,!0)}attach(){if(!this.attached){this.attached=!0,this.eventListeners={};var e=this;for(let o in this.eventHandlers){var t=JSON.parse(o),s=t.eventName,r=t.capture,n=t.isWindow;function i(){var t=this.eventHandlers[o],i=function(s){for(var r=0;r<t.length;r++)t[r].call(e,s)};n?window.addEventListener(s,i,r):window.document.addEventListener(s,i,r),this.eventListeners[o]=i}i.call(this)}}}detach(){if(this.attached){this.attached=!1;for(let r in this.eventListeners){var e=JSON.parse(r),t=e.eventName,s=e.capture;e.isWindow?window.removeEventListener(t,this.eventListeners[r],s):window.document.removeEventListener(t,this.eventListeners[r],s)}delete this.eventListeners}}addEventHandler(e,t,s,r,n){s.handlerName=e;let i=JSON.stringify({eventName:t,capture:r,isWindow:n});this.eventHandlers[i]||(this.eventHandlers[i]=[]),this.eventHandlers[i].push(s)}typeEventHandler(e){if(e.target.tagName&&0==this.typeLock&&(this.typeLock=1)){var t=e.target.tagName.toLowerCase(),s=e.target.type,r=e.target.getBoundingClientRect(),n=window.scrollX,i=window.scrollY,o=r.left+n,a=r.top+i;if("input"==t&&w.indexOf(s)>=0)if(e.target.value.length>0){if(this.recordEvent("type",this.selectorGenerator.targetProperties(e.target),e.target.value,o,a,n,i),window._browsee.sessionRecorder&&window._browsee.sessionRecorder.mirrorClient&&window._browsee.sessionRecorder.mirrorClient.applySimulated({added:[],characterDataChanged:[],removed:[],reordered:[],reparented:[],attributeChanged:{value:[e.target]}}),null!=this.enterTarget){for(var c=e.target.parentElement,l=c.tagName.toLowerCase();"form"!=l&&"body"!=l;)l=(c=c.parentElement).tagName.toLowerCase();"form"!=l||!c.hasAttribute("id")&&!c.hasAttribute("name")||c.hasAttribute("onsubmit")?this.recordEvent("sendKeys",this.selectorGenerator.targetProperties(this.enterTarget),"${KEY_ENTER}",o,a,n,i):c.hasAttribute("id")?this.recordEvent("submit",[["id="+c.id,"id"]],"",o,a,n,i):c.hasAttribute("name")&&this.recordEvent("submit",[["name="+c.name,"name"]],"",o,a,n,i),this.enterTarget=null}}else this.recordEvent("type",this.selectorGenerator.targetProperties(e.target),e.target.value,o,a,n,i);else"textarea"==t&&(this.recordEvent("type",this.selectorGenerator.targetProperties(e.target),e.target.value,o,a,n,i),window._browsee.sessionRecorder&&window._browsee.sessionRecorder.mirrorClient&&window._browsee.sessionRecorder.mirrorClient.applySimulated({added:[],characterDataChanged:[],removed:[],reordered:[],reparented:[],attributeChanged:{value:[e.target]}}))}this.typeLock=0}clickAtEventHandler(e){if(0==e.button&&!this.preventClick&&e.isTrusted){if(!this.preventClickTwice){var t=e.target.getBoundingClientRect(),s=Math.round(100*(e.clientX-t.left)/t.width),r=Math.round(100*(e.clientY-t.top)/t.height);e.target;this.recordEvent("clickAt",this.selectorGenerator.targetProperties(e.target),s+","+r,e.pageX,e.pageY,window.scrollX,window.scrollY,e),this.preventClickTwice=!0}var n=this;setTimeout((function(){n.preventClickTwice=!1}),30)}}doubleClickAtEventHandler(e){var t=e.target.getBoundingClientRect();Math.round(100*(e.pageX-t.left)/t.width),Math.round(100*(e.pageY-t.top)/t.height)}dispatchMouseMovents(){if(this.movements&&this.movements.length){var e=Object.assign({},{movements:this.movements});this.recordEvent("mouseMove",e),delete this.movements}}mouseMovementHandler(e){this.movements||(this.movements=[]);var t=(new Date).getTime();(t-this.lastMouseMovement>5||!this.lastMouseMovement)&&this.movements.push([e.clientX,e.clientY,t]),this.lastMouseMovement=t,clearTimeout(this.mouseDispatchTimeout),this.mouseDispatchTimeout=setTimeout(this.dispatchMouseMovents.bind(this),500)}scrollEventHandler(e){if(!0===this.pageLoaded){var t=this;this.currentScroll;this.scrollDetector=e.target;var s=window.scrollY;this.scrollDetector!==window.document&&(s=this.scrollDetector.scrollTop),this.currentScroll||(this.currentScroll=s),clearTimeout(this.prevTimeOut),this.prevTimeOut=setTimeout(function(){var e={start:window.innerHeight+t.currentScroll,end:window.innerHeight+s,viewHeight:window.innerHeight},r=null;this.scrollDetector!==window.document&&(r=this.selectorGenerator.targetProperties(this.scrollDetector),Object(n.a)("Scroll of: ",e.element)),this.recordEvent("scroll",e,r,null,null,window.scrollX,s),delete t.scrollDetector,delete t.currentScroll}.bind(t),100)}}pageLoadEventHandler(e){var t=this;"interactive"!==window.document.readyState&&"loaded"!==window.document.readyState||this.checkUrl(),"loading"===window.document.readyState?this.pageLoaded=!1:"interactive"===window.document.readyState||(this.pageLoaded=!1,clearTimeout(this.readyTimeOut),this.readyTimeOut=setTimeout(function(){t.pageLoaded=!0}.bind(t),500))}selectFocusEventHandler(e){if(e.target.nodeName){var t=e.target.nodeName.toLowerCase();if("select"==t&&e.target.multiple)for(var s=e.target.options,r=0;r<s.length;r++)null==s[r]._wasSelected&&(s[r]._wasSelected=s[r].selected);-1!==["input","select"].indexOf(t)?(this.inputFocusTarget=e.target,this.inputFocusTime=(new Date).getTime()):this.inputFocusTarget=null}}blurFocusEventHandler(e){if(e.target.nodeName&&this.inputFocusTarget&&this.inputFocusTarget==e.target){var t=(new Date).getTime()-this.inputFocusTime;this.recordEvent("input",this.selectorGenerator.targetProperties(e.target),t,e.pageX,e.pageY,window.scrollX,window.scrollY)}}windowBlurEventHandler(e){e.target.nodeName||this.recordEvent("blur")}windowFocusEventHandler(e){e.target.nodeName||this.recordEvent("focus")}windowResizeEventHandler(){var e=this;clearTimeout(this.prevResizeTimeOut),this.prevResizeTimeOut=setTimeout((function(){e.recordEvent("resize",{width:window.innerWidth,height:window.innerHeight})}),100)}getOptionLocator(e){var t=e.text.replace(/^ *(.*?) *$/,"$1");return t.match(/\xA0/)?"label=regexp:"+t.replace(/[\(\)\[\]\\\^\$\*\+\?\.\|\{\}]/g,(function(e){return"\\"+e})).replace(/\s+/g,(function(e){return e.match(/\xA0/)?e.length>1?"\\s+":"\\s":e})):"label="+t}selectChangeEventHandler(e){if(e.target.tagName&&"select"==e.target.tagName.toLowerCase())if(e.target.multiple){for(var t=e.target.options,s=0;s<t.length;s++)if(t[s]._wasSelected,t[s]._wasSelected!=t[s].selected){var r=this.getOptionLocator(t[s]);t[s].selected?this.recordEvent("addSelection",this.selectorGenerator.targetProperties(e.target),r,e.pageX,e.pageY,window.scrollX,window.scrollY):this.recordEvent("removeSelection",this.selectorGenerator.targetProperties(e.target),r,e.pageX,e.pageY,window.scrollX,window.scrollY),t[s]._wasSelected=t[s].selected}}else{var n=e.target.options[e.target.selectedIndex];this.recordEvent("select",this.selectorGenerator.targetProperties(e.target),this.getOptionLocator(n),e.pageX,e.pageY,window.scrollX,window.scrollY),window._browsee.sessionRecorder&&window._browsee.sessionRecorder.mirrorClient&&window._browsee.sessionRecorder.mirrorClient.applySimulated({added:[],characterDataChanged:[],removed:[],reordered:[],reparented:[],attributeChanged:{selected:[n]}})}}}s(2);class S{constructor(e,t,s){this.events=[],this.session=e,this.transport=t,this.trackHandler=s}sendEvents(){this.transport.socketSend({f:"events",events:this.events}),this.events=[]}addMouseEvent(e,t,s){this.events&&this.events.length>0&&this.events[this.events.length-1].type==e&&this.events[this.events.length-1].url==t?this.events[this.events.length-1].mouseData.push(s):this.events.push({type:e,url:t,etime:this.session.getEngagementTime(),pagetime:this.session.getPageTimeSpent(),stime:this.session.getSessionTimeSpent(),width:window.innerWidth,height:window.innerHeight,mouseData:[s]})}addEvent(e,t,s){this.events||(this.events=[]),e==i.EventTypes.MOUSE?this.addMouseEvent(e,t,s):this.events.push({type:e,url:t,etime:this.session.getEngagementTime(),pagetime:this.session.getPageTimeSpent(),stime:this.session.getSessionTimeSpent(),data:s}),this.nextbatch&&window.clearTimeout(this.nextbatch),this.nextbatch=window.setTimeout(this.sendEvents.bind(this),500)}}class T{generateEventId(){return Math.floor(99999999*Math.random()+1)}getStoredEvents(){var e=sessionStorage.getItem("_browsee_temp");return e?JSON.parse(e):{}}storeEvents(e){sessionStorage.setItem("_browsee_temp",JSON.stringify(e))}storeEvent(e,t){var s=this.getStoredEvents();s[e]=t,this.storeEvents(s)}deleteEvent(e){var t=this.getStoredEvents();delete t[e],this.storeEvents(t)}deleteAll(){sessionStorage.removeItem("_browsee_temp")}}const E=function(e,t,s){var r=JSON.stringify({_id:e,_identified:t,_p:s});i.isASCII(r)&&(r=btoa(r)),localStorage.setItem("_brId",r)};class b{constructor(e,t){this.init(e,t)}init(e,t){if(null!=e)return this.id=e,this.identified=!0,this.params=t||{},void E(this.id,this.identified,this.params);var s=function(){var e=localStorage.getItem("_brId");try{return"{"!==e[0]&&i.isASCII(e)?JSON.parse(atob(e)):"{"==e[0]?JSON.parse(e):null}catch(e){return null}}();s?(this.id=s._id,this.identified=s._identified,this.params=s._p):(this.id=i.guid(),this.identified=!1,this.params={},E(this.id,this.identified,this.params))}getId(){return this.id}getParams(){return this.params}isIdentified(){return this.identified}identify(e,t){if(e!=this.id||!i.objectEquals(t,this.params)){var s=this.id;return this.id=e,this.identified=!0,this.params=t,E(this.id,this.identified,this.params),s}return null}}class k{constructor(){this.reset(),this.engagementTime=0}reset(){this.start=(new Date).getTime(),this.updateEvent()}getEngagementTime(){return this.engagementTime}updateEvent(){this.start?this.engagementTime=(new Date).getTime()-this.start:this.start=(new Date).getTime(),this.eventTimer&&window.clearTimeout(this.eventTimer);var e=this;this.eventTimer=window.setTimeout((function(){e.creditEngagement()}),6e4)}creditEngagement(){this.start&&(this.engagementTime=(new Date).getTime()-this.start,this.start=null)}}const C=(e,t,s,r)=>{localStorage.setItem("_browsee",JSON.stringify({_id:e,_t:t,_r:s,_p:r}))},y=e=>{localStorage.setItem("_brt",JSON.stringify({_t:e}))},O=e=>_(e,localStorage),_=(e,t)=>{var s=t.getItem(e);return s?JSON.parse(s):null};class I{constructor(e){this.initSession(),this.setSessionUrl(e)}initSession(){var e=O("_browsee"),t=O("_brt");this.handleWindowId(),!e||!t||this.lastEvent&&(new Date).getTime()-this.lastEvent>18e5||t&&(new Date).getTime()-t._t>18e5?this.createNewSession():(this.sessionId=e._id,this.sessionTime=e._t,this.record=e._r,this.prefs={},void 0!==e._c&&(this.prefs.co=e._c),void 0!==e._e&&(this.prefs.et=e._e),void 0!==e._p&&(this.prefs=e._p),this.initReferrer()),window.addEventListener("beforeunload",this.onUnload.bind(this))}initReferrer(){var e=_("_br_ref",sessionStorage);e?(this.referrer=e.ref,this.landingPage=e.lp):this.getSessionReferrer()}getId(){return this.sessionId}getWindowId(){return this.windowId}onUnload(){sessionStorage.setItem("_brlwId",this.windowId)}handleWindowId(){var e=sessionStorage.getItem("_brlwId");e?sessionStorage.removeItem("_brlwId"):e=i.s4(),this.windowId=e}getSessionState(){return this.hasSessionState()?{rec:this.record,prefs:this.prefs}:null}hasSessionState(){return void 0!==this.record&&null!==this.record||void 0!==this.prefs&&Object.keys(this.prefs).length}setSessionState(e){this.record=e.rec,e.prefs?this.prefs=e.prefs:(this.prefs.et=e.et,this.prefs.co=e.co),C(this.sessionId,this.sessionTime,this.record,this.prefs)}setRecordingState(e){this.record=e,C(this.sessionId,this.sessionTime,this.record,this.prefs)}getRecordingState(){return this.record}getSessionStartTime(){return this.sessionTime}getSessionTimeSpent(){return(new Date).getTime()-this.sessionTime}getPageLoadedTime(){return this.pageLoadedTime}getPageTimeSpent(){return(new Date).getTime()-this.pageLoadedTime.getTime()}getSessionUrl(){return this.sessionUrl}getEngagementTime(){return this.engagementTimer.getEngagementTime()}getReferrer(){return this.referrer}getLandingPage(){return this.landingPage}createNewSession(){this.prefs={},this.record=null,this.sessionId=i.generate12CharacterString(),this.sessionTime=(new Date).getTime(),C(this.sessionId,this.sessionTime),this.initReferrer()}getSessionReferrer(){var e,t;this.referrer=window.document.referrer,this.landingPage=window.location.href,e=this.referrer,t=this.landingPage,sessionStorage.setItem("_br_ref",JSON.stringify({ref:e,lp:t}))}updateEvent(){return this.lastEvent&&(new Date).getTime()-this.lastEvent>18e5?(this.createNewSession(),this.engagementTimer.reset(),this.lastEvent=(new Date).getTime(),y(this.lastEvent),this.engagementTimer.updateEvent(),!0):(this.lastEvent=(new Date).getTime(),y(this.lastEvent),this.engagementTimer.updateEvent(),!1)}setSessionUrl(e){return this.sessionUrl&&this.sessionUrl==e?(this.updateEvent(),!1):(this.sessionUrl=e,this.pageLoadedTime=new Date,delete this.engagementTimer,this.engagementTimer=new k,this.updateEvent(),!0)}}const L=s(2).WEBSOCKET_URL+"session";class N{constructor(e,t,s,r){this.init(),this.apiKey=e,this.session=t,this.user=s,this.messageHandler=r,this.queue=[]}init(){this.socket||(this.socket=new WebSocket(L),this.socket.onopen=this.onOpen.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this))}reset(){this.socket=new WebSocket(L),this.socket.onopen=this.onOpen.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this)}socketSend(e){if(this.socket||this.init(),this.socket&&this.socket.readyState!==this.socket.OPEN)this.queue.push(e);else{var t={apiKey:this.apiKey,sessionId:this.session.getId(),wId:this.session.getWindowId(),record:this.session.getRecordingState(),url:this.session.getSessionUrl(),time:this.session.getSessionTimeSpent()};e.session=t,this.socket.send(JSON.stringify(e))}}onOpen(){var e={f:"start",width:window.innerWidth,height:window.innerHeight,scrollX:window.scrollX,scrollY:window.scrollY,referrer:this.session.getReferrer(),landingPage:this.session.getLandingPage(),user:this.user.getId(),identified:this.user.isIdentified(),userParams:this.user.getParams()};if(this.socketSend(e),this.queue.length>0){for(var t=0;t<this.queue.length;t++)this.socketSend(this.queue[t]);this.queue=[]}}onMessage(e){try{var t=JSON.parse(e.data);this.messageHandler&&this.messageHandler(t)}catch(t){Object(n.a)("Invalid JSON: ",e.data)}}onClose(){this.socket=void 0}onError(e){Object(n.a)("Error in Websocket")}}var R=s(3),A=window._browsee||[];const P=()=>{var e=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){this._brrequestId=Math.floor(99999999*Math.random()+1);const t=[].slice.call(arguments);return this._method=t[0],this._url=t[1],e.apply(this,t)};var t=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.send=function(){var e=this.onreadystatechange,s=function(){e&&e.apply(this,[].slice.call(arguments)),4==this.readyState&&A.trackResponse(this._brrequestId,this.status,this._url)};e?this.onreadystatechange=s:this.addEventListener("readystatechange",s);var r=t.apply(this,[].slice.call(arguments));return A.trackSend(this._brrequestId,this._method,this._url),r}};var U={metrics:["navigationStart","domainLookupEnd","connectEnd","requestStart","responseEnd","domInteractive","domContentLoadedEventStart","domComplete","loadEventStart"],getLoadNumbers:function(){var e={};if("performance"in window&&"PerformanceObserver"in window){var t=window.performance.timing.navigationStart;U.metrics.forEach(s=>{e[s]=window.performance.timing[s]-t})}return e}};const H=s(2);var D=window._browsee||function(){(D.q=D.q||[]).push(arguments)};D.pUrl=function(){return document.location.pathname+document.location.hash},D.checkUrl=function(){if(D.session&&D.recorder&&D.session.setSessionUrl(document.location.href)){D.recorder.addEvent(i.EventTypes.URL,D.pUrl(),{scroll:window.innerHeight+window.scrollY,scrollY:window.scrollY});var e=new Event("br_page_change");window.dispatchEvent(e)}},D.checkUrlAndAddEvent=function(e,t,s){D.checkUrl(),D.recorder&&D.recorder.addEvent(e,t,s),D.checkUrlEvent&&clearTimeout(D.checkUrlEvent),D.checkUrlEvent=setTimeout(D.checkUrl,200)},D.trackSend=function(e,t,s){const r=(new Date).getTime();D.requests||(D.requests={}),s&&s.split&&-1==s.indexOf(H.API_URL)&&!D.requests[e]&&window.document.hasFocus()&&(D.requests[e]={start:r,method:t,url:s.split("?")[0]},D.checkUrlAndAddEvent(i.EventTypes.NETWORK_CALL,D.pUrl(),D.requests[e]),D.clickTracker&&D.clickTracker.updateNetworkCall(D.requests[e]))},D.trackResponse=function(e,t,s){const r=(new Date).getTime();var n;D.requests&&D.requests[e]&&window.document.hasFocus()&&((n=Object.assign?Object.assign({},D.requests[e]):JSON.parse(JSON.stringify(D.requests[e]))).statusCode=t,n.time=r-n.start,n.stime=D.session.getSessionTimeSpent(),delete n.start,D.checkUrlAndAddEvent(1,D.pUrl(),n),delete D.requests[e])},D.recordEvent=function(e,t,s,r,o,a,c,l){D.session&&(D.session.updateEvent()&&D.getSessionState());const d=D.session.getPageTimeSpent(),h=D.session.getSessionTimeSpent(),u=D.session.getSessionStartTime(),g=D.pUrl();var m;if(D.recorder&&"mouseMove"==e)return t.movements&&(t.movements.forEach(e=>{e[2]-=u}),m=t.movements),void D.recorder.addEvent(i.EventTypes.MOUSE,g,{x:r,y:o,scrollX:a,scrollY:c,time:d,stime:h,movements:m});Object(n.a)("Recording: "+e+" at: "+d);var v={url:g,type:e,properties:t,time:d,stime:h,wId:D.session.getWindowId(),target:s,x:r,y:o,scrollX:a,scrollY:c};if("clickAt"==e||"doubleClickAt"==e){var w=null;D.eventStore&&(w=D.eventStore.generateEventId(),D.eventStore.storeEvent(w,JSON.stringify(v))),D.clickTracker.updateClick({event:l,x:r,y:o,scrollX:a,scrollY:c,time:h},"doubleClickAt"==e,(function(e,t){D.eventStore&&D.eventStore.deleteEvent(w),e==p&&Object(n.a)("Dead or input click");var s=v,r=s.url;delete s.url,delete s.wId,s.changes=t,s.position=s.target,delete s.target,D.checkUrlAndAddEvent(i.EventTypes.EVENT,r,s)}))}else{var f=v;delete f.url,delete f.wId,"input"==e&&(f.inputtime=f.target,delete f.target),D.checkUrlAndAddEvent(i.EventTypes.EVENT,g,f)}},D.sendStoredEvents=function(){if(D.eventStore){var e=D.eventStore.getStoredEvents();for(var t in e)if(e.hasOwnProperty(t)){var s=JSON.parse(e[t]),r=s.url;s.wId==D.session.getWindowId()&&(s.position=s.target,delete s.target,delete s.url,delete s.wId,n=s,D.checkUrlAndAddEvent(i.EventTypes.EVENT,r,n))}D.eventStore.deleteAll()}var n},D.sendRageClick=function(e,t,s,r){D.sendClickData(h,e,t,s,r,window.innerWidth,window.innerHeight)},D.sendDeadClick=function(e,t,s,r){},D.sendClickData=function(e,t,s,n,i,o,a){if(D.session.getRecordingState()===r.a.RecordingStates.ALL){var c={apiKey:D.apiKey,sessionId:D.session.getId(),wId:D.session.getWindowId(),url:n,time:i,type:e,coords:t,element:s,width:o,height:a};Object(R.a)({url:H.API_URL+"api/clickdata",method:"POST",data:JSON.stringify(c)})}},D.handleSocketResponse=function(e){e.record&&(D.session.setRecordingState(e.record),e.record==r.a.RecordingStates.ALL&&D.load("replay.min.js","Recorder Loaded"))},D.handleTrackResponse=function(e){var t=JSON.parse(e);t.elements&&t.elements.length},D.findOffset=function(e,t){var s=e.getBoundingClientRect(),r={x:0,y:0};return t.x&&t.y&&(r.x=t.x-s.x,r.y=t.y-s.y),r},D.sendPageLoad=function(){if(D.pageLoad&&D.recorder){var e=D.pageLoad;return void D.recorder.addEvent(i.EventTypes.PAGE_LOAD,e.url,{scroll:e.scroll,performance:e.performance})}const t=D.pUrl(),s=window.innerHeight+window.scrollY,r=U.getLoadNumbers();D.recorder?D.recorder.addEvent(i.EventTypes.PAGE_LOAD,t,{scroll:s,performance:r}):D.pageLoad={url:t,scroll:s,performance:r}},D.onPageLoad=function(){"complete"===document.readyState?D.sendPageLoad():document.addEventListener("readystatechange",(function(e){"complete"===e.target.readyState&&D.sendPageLoad()}))},D.getSessionState=function(){D.user=D.user||new b,Object(R.a)({url:H.API_URL+"sessionstate?_a="+D.apiKey+"&_u="+D.user.getId()+"&_d="+(i.isDnt()?"1":"0")+"&_l="+encodeURIComponent(D.pUrl()),method:"GET",dataType:"text/plain",withCredentials:!1,success:function(e){if(e){var t=JSON.parse(e);D.session.setSessionState(t),D.setSession(D.session.getSessionState())}}})},D.setTestParams=function(){if(document.location.search&&URLSearchParams){var e=new URLSearchParams(document.location.search);e.has(i.BrowseeUrlParams.RECORD)&&D.session?D.session.setRecordingState(r.a.RecordingStates.ALL):e.has(i.BrowseeUrlParams.TEST_INSTALLATION)&&i.testInstallation(D.getRecordingUrl())}},D.onLoad=function(){this.url=document.location.href,D.session=new I(this.url),D.setTestParams(),D.onPageLoad();var e=D.session.getSessionState();e?D.setSession(e):D.getSessionState()},D.load=function(e,t){Object(R.b)(H.CDN_URL+H.JS_PATH+e,document.body,(function(){Object(n.a)(t)}))},D.setSession=function(e){if(void 0!==e.rec&&null!==e.rec){var t=e.rec;Object(n.a)("Setting record state: "+e.rec),t!==r.a.RecordingStates.NONE&&(D.user=D.user||new b,D.transport=new N(D.apiKey,D.session,D.user,D.handleSocketResponse),D.eventTracker=new f(D.recordEvent,D.checkUrl),D.eventTracker.attach(),delete D.clickTracker,D.clickTracker=new v(D.sendRageClick,D.sendDeadClick),D.recorder=new S(D.session,D.transport,D.handleTrackResponse),D.eventStore=new T,D.sendStoredEvents(),D.recorder.addEvent(i.EventTypes.URL,D.pUrl(),{scroll:window.innerHeight+window.scrollY,scrollY:window.scrollY}),D.pageLoad&&D.sendPageLoad(),(e=>{if(e&&e.prefs&&e.prefs.it&&e.prefs.it.length){var t=e.prefs.it,s=window._browsee.getRecordingUrl();if(s){if(-1!==t.indexOf(i.Integrations.INTERCOM)&&window.Intercom&&(Object(n.a)("Intercom:"+s),window.Intercom("trackEvent","Browsee Recording",{session:{url:s,value:"View Session in Browsee"}})),-1!==t.indexOf(i.Integrations.GOOGLE_ANALYTICS)&&window.ga&&window.ga.getAll){const e=window.ga.getAll()[0];e&&e.send("event","Browsee Recording",s,"")}-1!==t.indexOf(i.Integrations.TAWKTO)&&window.Tawk_API&&(Tawk_API.addTags?Tawk_API.addTags([s],(function(){})):Tawk_API.onLoad=function(){Tawk_API.addTags([s],(function(){}))})}}})(e),P(),(s=window.fetch)&&(window.fetch=function(){var e=[].slice.call(arguments);const t=e[1]?e[1].method:"GET",r=e[0];return new Promise((function(n,i){var o=Math.floor(99999999*Math.random()+1);s.apply(window,e).then((function(e){n(e),A.trackResponse(o,e.status)})).catch((function(e){i(e),A.trackResponse(o,e.status)})),A.trackSend(o,t,r)}))}),t!==r.a.RecordingStates.NO_DOM&&(D.resetSessionRecorder?D.resetSessionRecorder():D.load("replay.min.js","Recorder Loaded")),(e.prefs.et||null==e.prefs.et)&&(D.setErrorTracker?D.setErrorTracker():D.load("raven.min.js","Raven Loaded")))}var s;e.prefs.co&&D.load("components.min.js","Components Loaded"),D.replaceQueue()},D.init=function(e){D.apiKey=e,D.initialized=!0},D.logEvent=function(e,t){if(!(null==e||"string"!=typeof e||e.length>250))return D.recorder&&D.recorder.addEvent(i.EventTypes.CUSTOM_EVENT,D.pUrl(),{text:e,params:t}),!0;console.log("Event names must be valid text")},D.identify=function(e,t){if(null!=e&&"string"==typeof e){if(D.user){var s=D.user.identify(e,t);s&&D.recorder&&D.recorder.addEvent(i.EventTypes.IDENTIFY,D.pUrl(),{id:e,params:t,anonymousId:s})}else D.user=new b(e,t);return!0}console.log("Invalid ID provided to identify call")},D.getRecordingUrl=function(e){var t="";D.session&&(D.session.getRecordingState()==r.a.RecordingStates.ALL&&(t="https://browsee.io/app/session/"+D.session.getId()));return e&&e(t),t},D.getSessionUrl=function(e){var t="https://browsee.io/app/session/";return D.session&&(t+=D.session.getId()),e&&e(t),t},D.applyMethod=function(e){var t=[].slice.call(e),s=t.shift();if(D[s])try{D[s].apply(null,t)}catch(e){console.error(e)}},D.processQueue=function(){for(var e=0;e<D.q.length;e++)D.applyMethod(D.q.shift())},D.replaceQueue=function(){D.q.length&&D.processQueue(),D.q.push=function(e){D.applyMethod(e)}},Object(n.a)("Browsee loaded"),D.q&&(D.processQueue(),D.onLoad())}]);